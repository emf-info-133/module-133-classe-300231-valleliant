{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import{loginUser,registerUser,getUser}from'../services/authService';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{// Essayer de récupérer l'utilisateur depuis le localStorage\nconst storedUser=localStorage.getItem('user');const token=localStorage.getItem('token');if(storedUser&&token){try{setUser(JSON.parse(storedUser));setLoading(false);}catch(err){// Si les données sont corrompues, nettoyer le localStorage\nlocalStorage.removeItem('token');localStorage.removeItem('user');setLoading(false);}}else{setLoading(false);}},[]);const login=async(email,password)=>{setError(null);try{const data=await loginUser(email,password);// Stocker le token et l'utilisateur dans le localStorage\nlocalStorage.setItem('token',data.token);localStorage.setItem('user',JSON.stringify(data.user));setUser(data.user);return data.user;}catch(err){setError(err.message||'Échec de la connexion');throw err;}};const register=async(name,email,password)=>{setError(null);try{const data=await registerUser(name,email,password);// Stocker le token et l'utilisateur dans le localStorage\nlocalStorage.setItem('token',data.token);localStorage.setItem('user',JSON.stringify(data.user));setUser(data.user);return data.user;}catch(err){setError(err.message||'Échec de l\\'inscription');throw err;}};const logout=()=>{// Nettoyer le localStorage\nlocalStorage.removeItem('token');localStorage.removeItem('user');setUser(null);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,loading,error,login,register,logout},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","loginUser","registerUser","getUser","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","error","setError","storedUser","localStorage","getItem","token","JSON","parse","err","removeItem","login","email","password","data","setItem","stringify","message","register","name","logout","Provider","value"],"sources":["/root/projet/module-133-classe-300231-valleliant/projet/client1/src/contexts/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\nimport { loginUser, registerUser, getUser } from '../services/authService';\n\nexport const AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    // Essayer de récupérer l'utilisateur depuis le localStorage\n    const storedUser = localStorage.getItem('user');\n    const token = localStorage.getItem('token');\n    \n    if (storedUser && token) {\n      try {\n        setUser(JSON.parse(storedUser));\n        setLoading(false);\n      } catch (err) {\n        // Si les données sont corrompues, nettoyer le localStorage\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        setLoading(false);\n      }\n    } else {\n      setLoading(false);\n    }\n  }, []);\n\n  const login = async (email, password) => {\n    setError(null);\n    try {\n      const data = await loginUser(email, password);\n      \n      // Stocker le token et l'utilisateur dans le localStorage\n      localStorage.setItem('token', data.token);\n      localStorage.setItem('user', JSON.stringify(data.user));\n      \n      setUser(data.user);\n      return data.user;\n    } catch (err) {\n      setError(err.message || 'Échec de la connexion');\n      throw err;\n    }\n  };\n\n  const register = async (name, email, password) => {\n    setError(null);\n    try {\n      const data = await registerUser(name, email, password);\n      \n      // Stocker le token et l'utilisateur dans le localStorage\n      localStorage.setItem('token', data.token);\n      localStorage.setItem('user', JSON.stringify(data.user));\n      \n      setUser(data.user);\n      return data.user;\n    } catch (err) {\n      setError(err.message || 'Échec de l\\'inscription');\n      throw err;\n    }\n  };\n\n  const logout = () => {\n    // Nettoyer le localStorage\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    setUser(null);\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, loading, error, login, register, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}; "],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CACjE,OAASC,SAAS,CAAEC,YAAY,CAAEC,OAAO,KAAQ,yBAAyB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE3E,MAAO,MAAM,CAAAC,WAAW,cAAGR,aAAa,CAAC,CAAC,CAE1C,MAAO,MAAM,CAAAS,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACvC,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGZ,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACa,OAAO,CAAEC,UAAU,CAAC,CAAGd,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACe,KAAK,CAAEC,QAAQ,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CAExCC,SAAS,CAAC,IAAM,CACd;AACA,KAAM,CAAAgB,UAAU,CAAGC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAC/C,KAAM,CAAAC,KAAK,CAAGF,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAE3C,GAAIF,UAAU,EAAIG,KAAK,CAAE,CACvB,GAAI,CACFR,OAAO,CAACS,IAAI,CAACC,KAAK,CAACL,UAAU,CAAC,CAAC,CAC/BH,UAAU,CAAC,KAAK,CAAC,CACnB,CAAE,MAAOS,GAAG,CAAE,CACZ;AACAL,YAAY,CAACM,UAAU,CAAC,OAAO,CAAC,CAChCN,YAAY,CAACM,UAAU,CAAC,MAAM,CAAC,CAC/BV,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,IAAM,CACLA,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAW,KAAK,CAAG,KAAAA,CAAOC,KAAK,CAAEC,QAAQ,GAAK,CACvCX,QAAQ,CAAC,IAAI,CAAC,CACd,GAAI,CACF,KAAM,CAAAY,IAAI,CAAG,KAAM,CAAA1B,SAAS,CAACwB,KAAK,CAAEC,QAAQ,CAAC,CAE7C;AACAT,YAAY,CAACW,OAAO,CAAC,OAAO,CAAED,IAAI,CAACR,KAAK,CAAC,CACzCF,YAAY,CAACW,OAAO,CAAC,MAAM,CAAER,IAAI,CAACS,SAAS,CAACF,IAAI,CAACjB,IAAI,CAAC,CAAC,CAEvDC,OAAO,CAACgB,IAAI,CAACjB,IAAI,CAAC,CAClB,MAAO,CAAAiB,IAAI,CAACjB,IAAI,CAClB,CAAE,MAAOY,GAAG,CAAE,CACZP,QAAQ,CAACO,GAAG,CAACQ,OAAO,EAAI,uBAAuB,CAAC,CAChD,KAAM,CAAAR,GAAG,CACX,CACF,CAAC,CAED,KAAM,CAAAS,QAAQ,CAAG,KAAAA,CAAOC,IAAI,CAAEP,KAAK,CAAEC,QAAQ,GAAK,CAChDX,QAAQ,CAAC,IAAI,CAAC,CACd,GAAI,CACF,KAAM,CAAAY,IAAI,CAAG,KAAM,CAAAzB,YAAY,CAAC8B,IAAI,CAAEP,KAAK,CAAEC,QAAQ,CAAC,CAEtD;AACAT,YAAY,CAACW,OAAO,CAAC,OAAO,CAAED,IAAI,CAACR,KAAK,CAAC,CACzCF,YAAY,CAACW,OAAO,CAAC,MAAM,CAAER,IAAI,CAACS,SAAS,CAACF,IAAI,CAACjB,IAAI,CAAC,CAAC,CAEvDC,OAAO,CAACgB,IAAI,CAACjB,IAAI,CAAC,CAClB,MAAO,CAAAiB,IAAI,CAACjB,IAAI,CAClB,CAAE,MAAOY,GAAG,CAAE,CACZP,QAAQ,CAACO,GAAG,CAACQ,OAAO,EAAI,yBAAyB,CAAC,CAClD,KAAM,CAAAR,GAAG,CACX,CACF,CAAC,CAED,KAAM,CAAAW,MAAM,CAAGA,CAAA,GAAM,CACnB;AACAhB,YAAY,CAACM,UAAU,CAAC,OAAO,CAAC,CAChCN,YAAY,CAACM,UAAU,CAAC,MAAM,CAAC,CAC/BZ,OAAO,CAAC,IAAI,CAAC,CACf,CAAC,CAED,mBACEN,IAAA,CAACC,WAAW,CAAC4B,QAAQ,EAACC,KAAK,CAAE,CAAEzB,IAAI,CAAEE,OAAO,CAAEE,KAAK,CAAEU,KAAK,CAAEO,QAAQ,CAAEE,MAAO,CAAE,CAAAxB,QAAA,CAC5EA,QAAQ,CACW,CAAC,CAE3B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}